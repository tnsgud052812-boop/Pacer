<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìº”íƒ‘ìŠ¤ ë§Œë³´ê±·ê¸° ë¦¬í¬íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            color: #333;
        }

        /* í—¤ë” */
        .header {
            background: #1e293b;
            color: #fff;
            padding: 24px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header-subtitle {
            font-size: 0.85rem;
            color: #94a3b8;
            margin-top: 4px;
        }

        .header-right {
            text-align: right;
        }

        .header-date {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .admin-link {
            display: inline-block;
            margin-top: 8px;
            padding: 6px 14px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            color: #fff;
            text-decoration: none;
            font-size: 0.8rem;
        }

        .admin-link:hover {
            background: rgba(255,255,255,0.2);
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* ìš”ì•½ ì¹´ë“œ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border-left: 4px solid #3b82f6;
        }

        .summary-card.gold { border-left-color: #f59e0b; }
        .summary-card.green { border-left-color: #10b981; }
        .summary-card.purple { border-left-color: #8b5cf6; }

        .summary-label {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
        }

        .summary-sub {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 4px;
        }

        /* ì„¹ì…˜ */
        .section {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .section-header {
            background: #f8fafc;
            padding: 16px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
        }

        .section-body {
            padding: 24px;
        }

        /* íƒ­ */
        .tabs {
            display: flex;
            gap: 4px;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 8px;
            width: fit-content;
        }

        .tab {
            padding: 8px 20px;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .tab.active {
            background: #fff;
            color: #1e293b;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        /* í…Œì´ë¸” */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
            background: #f8fafc;
        }

        .data-table td {
            padding: 14px 16px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.9rem;
        }

        .data-table tbody tr:hover {
            background: #f8fafc;
        }

        .data-table tbody tr {
            cursor: pointer;
        }

        /* ìˆœìœ„ ë±ƒì§€ */
        .rank-cell {
            width: 60px;
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .rank-1 { background: #fef3c7; color: #d97706; }
        .rank-2 { background: #f1f5f9; color: #64748b; }
        .rank-3 { background: #fed7aa; color: #c2410c; }
        .rank-default { background: #f8fafc; color: #94a3b8; }

        /* ê±¸ìŒìˆ˜ ë°” */
        .steps-cell {
            width: 200px;
        }

        .steps-bar-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .steps-bar-bg {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .steps-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .steps-value {
            font-weight: 600;
            color: #1e293b;
            min-width: 80px;
            text-align: right;
        }

        /* ê·¸ë£¹ ì¹´ë“œ */
        .group-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .group-header {
            padding: 16px 20px;
            background: #f8fafc;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .group-header:hover {
            background: #f1f5f9;
        }

        .group-rank {
            font-size: 1.2rem;
            font-weight: 700;
            color: #3b82f6;
            min-width: 40px;
        }

        .group-rank.gold { color: #d97706; }
        .group-rank.silver { color: #64748b; }
        .group-rank.bronze { color: #c2410c; }

        .group-info {
            flex: 1;
        }

        .group-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 1rem;
        }

        .group-meta {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 2px;
        }

        .group-stats {
            text-align: right;
        }

        .group-avg {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e293b;
        }

        .group-avg-label {
            font-size: 0.75rem;
            color: #64748b;
        }

        .group-expand {
            color: #94a3b8;
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .group-card.expanded .group-expand {
            transform: rotate(180deg);
        }

        .group-body {
            display: none;
            border-top: 1px solid #e2e8f0;
        }

        .group-card.expanded .group-body {
            display: block;
        }

        /* íŒ€ ì„¹ì…˜ */
        .team-section {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        .team-section:last-child {
            border-bottom: none;
        }

        .team-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .team-rank {
            font-weight: 700;
            color: #64748b;
            font-size: 0.85rem;
        }

        .team-name {
            font-weight: 600;
            color: #475569;
        }

        .team-avg {
            margin-left: auto;
            font-weight: 600;
            color: #3b82f6;
        }

        .team-members {
            display: none;
            margin-top: 12px;
            padding-left: 24px;
        }

        .team-section.expanded .team-members {
            display: block;
        }

        .member-row {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f8fafc;
            cursor: pointer;
        }

        .member-row:hover {
            background: #f8fafc;
            margin: 0 -8px;
            padding-left: 8px;
            padding-right: 8px;
        }

        .member-row:last-child {
            border-bottom: none;
        }

        .member-rank-num {
            width: 24px;
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .member-name {
            flex: 1;
            font-size: 0.9rem;
        }

        .member-avg {
            font-weight: 600;
            color: #1e293b;
            margin-right: 12px;
        }

        .member-total {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .chart-box {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
        }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #fff;
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 10;
        }

        .modal-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
        }

        .modal-close {
            background: #f1f5f9;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            font-size: 1.2rem;
            color: #64748b;
            cursor: pointer;
        }

        .modal-close:hover {
            background: #e2e8f0;
        }

        .modal-body {
            padding: 24px;
        }

        /* í†µê³„ ê·¸ë¦¬ë“œ */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-box {
            background: #f8fafc;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .stat-box-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
        }

        .stat-box-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 4px;
        }

        .stat-box-sub {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-top: 2px;
        }

        /* ìº˜ë¦°ë” */
        .calendar {
            margin-top: 24px;
        }

        .calendar-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-header {
            text-align: center;
            font-size: 0.7rem;
            color: #94a3b8;
            padding: 8px 0;
            font-weight: 600;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 0.8rem;
            background: #f8fafc;
        }

        .calendar-day.empty {
            background: transparent;
        }

        .calendar-day.has-data {
            background: #dbeafe;
        }

        .calendar-day.today {
            border: 2px solid #3b82f6;
        }

        .calendar-day .day-num {
            font-weight: 600;
            color: #475569;
        }

        .calendar-day .day-steps {
            font-size: 0.6rem;
            color: #64748b;
        }

        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .spinner {
            width: 36px;
            height: 36px;
            border: 3px solid #e2e8f0;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ê²€ìƒ‰ */
        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 14px;
            padding-left: 36px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
            background: #f8fafc;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: #fff;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 900px) {
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .header {
                padding: 16px 20px;
                flex-direction: column;
                text-align: center;
                gap: 12px;
            }
            .header-right {
                text-align: center;
            }
            .summary-grid {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 16px;
            }
            .section-body {
                padding: 16px;
            }
            .steps-cell {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <div class="header-title">ìº”íƒ‘ìŠ¤ ë§Œë³´ê±·ê¸° ë¦¬í¬íŠ¸</div>
            <div class="header-subtitle">ê·¸ë£¹ë³„ ì¼ì¼ í‰ê·  ê±¸ìŒìˆ˜ í˜„í™©</div>
        </div>
        <div class="header-right">
            <div class="header-date" id="updateTime">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
                <button onclick="location.reload(true)" class="admin-link" style="border:none;cursor:pointer;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                <a href="admin.html" class="admin-link">âš™ï¸ ê´€ë¦¬ì</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- ìš”ì•½ ì¹´ë“œ -->
        <div class="summary-grid">
            <div class="summary-card">
                <div class="summary-label">ì´ ì°¸ì—¬ì</div>
                <div class="summary-value" id="totalMembers">-</div>
                <div class="summary-sub">ëª…</div>
            </div>
            <div class="summary-card gold">
                <div class="summary-label">ì „ì²´ ì¼í‰ê· </div>
                <div class="summary-value" id="totalAvg">-</div>
                <div class="summary-sub">ë³´/ì¼</div>
            </div>
            <div class="summary-card green">
                <div class="summary-label">1ìœ„ ê·¸ë£¹</div>
                <div class="summary-value" id="topGroup">-</div>
                <div class="summary-sub" id="topGroupAvg"></div>
            </div>
            <div class="summary-card purple">
                <div class="summary-label">ì´ë²ˆë‹¬ ê²½ê³¼</div>
                <div class="summary-value" id="dayOfMonth">-</div>
                <div class="summary-sub">ì¼</div>
            </div>
        </div>

        <!-- ë©”ì¸ ì„¹ì…˜ -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">ğŸ“Š ìˆœìœ„ í˜„í™©</div>
                <div class="tabs">
                    <button class="tab active" data-tab="groups" onclick="switchTab('groups')">ê·¸ë£¹ ìˆœìœ„</button>
                    <button class="tab" data-tab="all" onclick="switchTab('all')">ì „ì²´ ë­í‚¹</button>
                </div>
            </div>
            <div class="section-body">
                <!-- ê·¸ë£¹ ìˆœìœ„ -->
                <div id="groupsTab">
                    <div id="groupRankings">
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                        </div>
                    </div>
                </div>

                <!-- ì „ì²´ ë­í‚¹ -->
                <div id="allTab" style="display:none;">
                    <div class="search-box" style="margin-bottom:16px;">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" class="search-input" id="searchInput" 
                               placeholder="ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." oninput="filterAllRanking()">
                    </div>
                    <div style="max-height:500px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:8px;">
                        <table class="data-table">
                            <thead style="position:sticky;top:0;z-index:1;">
                                <tr>
                                    <th class="rank-cell">ìˆœìœ„</th>
                                    <th>ì´ë¦„</th>
                                    <th>ì†Œì†</th>
                                    <th class="steps-cell">ì¼í‰ê· </th>
                                    <th style="text-align:right;">ë³´/ì¼</th>
                                </tr>
                            </thead>
                            <tbody id="allRankingBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- í†µê³„ ì„¹ì…˜ -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">ğŸ“Š í†µê³„</div>
                <div class="tabs">
                    <button class="tab active" data-stat="all" onclick="switchStatTab('all')">ì „ì²´</button>
                    <button class="tab" data-stat="group" onclick="switchStatTab('group')">ê·¸ë£¹ë³„</button>
                    <button class="tab" data-stat="team" onclick="switchStatTab('team')">íŒ€ë³„</button>
                </div>
            </div>
            <div class="section-body">
                <!-- ì „ì²´ í†µê³„ -->
                <div id="statAll">
                    <div class="chart-grid">
                        <div class="chart-box">
                            <div class="chart-title">ğŸ“ˆ ê·¸ë£¹ë³„ ì¼í‰ê·  ë¹„êµ</div>
                            <canvas id="groupChart"></canvas>
                        </div>
                        <div class="chart-box">
                            <div class="chart-title">ğŸ“Š ê±¸ìŒìˆ˜ ë¶„í¬ (ì „ì²´)</div>
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ê·¸ë£¹ë³„ í†µê³„ -->
                <div id="statGroup" style="display:none;">
                    <div style="margin-bottom:16px;">
                        <select id="groupSelect" class="search-input" style="width:auto;min-width:200px;" onchange="renderGroupStat()">
                            <option value="">ê·¸ë£¹ ì„ íƒ</option>
                        </select>
                    </div>
                    <div id="groupStatContent">
                        <div style="text-align:center;color:#94a3b8;padding:40px;">ê·¸ë£¹ì„ ì„ íƒí•˜ì„¸ìš”</div>
                    </div>
                </div>

                <!-- íŒ€ë³„ í†µê³„ -->
                <div id="statTeam" style="display:none;">
                    <div style="margin-bottom:16px;display:flex;gap:12px;">
                        <select id="teamGroupSelect" class="search-input" style="width:auto;min-width:200px;" onchange="updateTeamSelect()">
                            <option value="">ê·¸ë£¹ ì„ íƒ</option>
                        </select>
                        <select id="teamSelect" class="search-input" style="width:auto;min-width:200px;" onchange="renderTeamStat()">
                            <option value="">íŒ€ ì„ íƒ</option>
                        </select>
                    </div>
                    <div id="teamStatContent">
                        <div style="text-align:center;color:#94a3b8;padding:40px;">íŒ€ì„ ì„ íƒí•˜ì„¸ìš”</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê°œì¸ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="memberModal" onclick="if(event.target===this)closeModal()">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">ê°œì¸ ê¸°ë¡</span>
                <button class="modal-close" onclick="closeModal()">âœ•</button>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>ë¡œë”© ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GitHub ì„¤ì •
        const REPO_OWNER = 'tnsgud052812-boop';
        const REPO_NAME = 'Pacer';
        const BRANCH = 'main';

        // ë°ì´í„°
        let config = { groups: [] };
        let latestData = [];
        let groupChartInstance = null;
        let distChartInstance = null;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', loadAllData);

        async function loadAllData() {
            await Promise.all([loadConfig(), loadLatestData()]);
            renderSummary();
            renderGroupRankings();
            renderAllRanking();
            renderCharts();
        }

        // ì„¤ì • ë¡œë“œ
        async function loadConfig() {
            try {
                const url = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${BRANCH}/data/config.json?t=${Date.now()}`;
                const res = await fetch(url);
                if (res.ok) {
                    config = await res.json();
                }
            } catch (e) {
                console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }

        // ìµœì‹  ë°ì´í„° ë¡œë“œ
        async function loadLatestData() {
            try {
                const url = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${BRANCH}/data/latest.csv?t=${Date.now()}`;
                const res = await fetch(url);
                const csv = await res.text();
                latestData = parseCSV(csv);
                
                if (latestData.length > 0 && latestData[0]['í¬ë¡¤ë§ì¼ì‹œ']) {
                    document.getElementById('updateTime').textContent = 
                        `ìµœì¢… ì—…ë°ì´íŠ¸: ${latestData[0]['í¬ë¡¤ë§ì¼ì‹œ']}`;
                }
            } catch (e) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((h, idx) => {
                    row[h.trim()] = values[idx]?.trim() || '';
                });
                data.push(row);
            }
            return data;
        }

        // íƒ­ ì „í™˜
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            
            document.getElementById('groupsTab').style.display = tab === 'groups' ? 'block' : 'none';
            document.getElementById('allTab').style.display = tab === 'all' ? 'block' : 'none';
        }

        // ë©¤ë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getMemberData(name) {
            return latestData.find(d => d['ì´ë¦„'] === name) || {};
        }

        // ë“±ë¡ëœ ë©¤ë²„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        function getRegisteredMembers() {
            const members = new Set();
            config.groups.forEach(g => {
                (g.teams || []).forEach(t => {
                    (t.members || []).forEach(m => members.add(m));
                });
            });
            return members;
        }

        // ë“±ë¡ëœ ë©¤ë²„ ë°ì´í„°ë§Œ ê°€ì ¸ì˜¤ê¸°
        function getRegisteredMemberData() {
            const registered = getRegisteredMembers();
            return latestData.filter(d => registered.has(d['ì´ë¦„']));
        }

        // ìš”ì•½ ë Œë”ë§
        function renderSummary() {
            const today = new Date();
            const dayOfMonth = today.getDate();
            
            document.getElementById('dayOfMonth').textContent = dayOfMonth;
            
            // ë“±ë¡ëœ ë©¤ë²„ë§Œ ëŒ€ìƒ
            const registeredData = getRegisteredMemberData();
            document.getElementById('totalMembers').textContent = registeredData.length;

            // ì „ì²´ ì¼í‰ê·  (ë“±ë¡ëœ ë©¤ë²„ë§Œ)
            let totalSteps = 0;
            registeredData.forEach(d => {
                totalSteps += parseInt(d['ì›”ëˆ„ì ']) || 0;
            });
            const totalAvg = registeredData.length > 0 ? Math.floor(totalSteps / registeredData.length / dayOfMonth) : 0;
            document.getElementById('totalAvg').textContent = formatNumber(totalAvg);

            // 1ìœ„ ê·¸ë£¹
            if (config.groups.length > 0) {
                const groupStats = getGroupStats();
                if (groupStats.length > 0) {
                    document.getElementById('topGroup').textContent = groupStats[0].name;
                    document.getElementById('topGroupAvg').textContent = formatNumber(groupStats[0].avgDaily) + ' ë³´/ì¼';
                }
            }
        }

        // ê·¸ë£¹ í†µê³„ ê³„ì‚°
        function getGroupStats() {
            const today = new Date();
            const dayOfMonth = today.getDate();

            return config.groups.map(group => {
                let totalSteps = 0;
                let memberCount = 0;

                (group.teams || []).forEach(team => {
                    (team.members || []).forEach(name => {
                        const data = getMemberData(name);
                        totalSteps += parseInt(data['ì›”ëˆ„ì ']) || 0;
                        memberCount++;
                    });
                });

                const avgDaily = memberCount > 0 ? Math.floor(totalSteps / memberCount / dayOfMonth) : 0;

                return {
                    ...group,
                    totalSteps,
                    avgDaily,
                    memberCount
                };
            }).sort((a, b) => b.avgDaily - a.avgDaily);
        }

        // ê·¸ë£¹ ìˆœìœ„ ë Œë”ë§
        function renderGroupRankings() {
            const container = document.getElementById('groupRankings');
            
            if (config.groups.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center;padding:40px;color:#94a3b8;">
                        ì•„ì§ ê·¸ë£¹ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>
                        <a href="admin.html" style="color:#3b82f6;">ê´€ë¦¬ì í˜ì´ì§€</a>ì—ì„œ ê·¸ë£¹ì„ ì¶”ê°€í•˜ì„¸ìš”.
                    </div>
                `;
                return;
            }

            const today = new Date();
            const dayOfMonth = today.getDate();
            const groupStats = getGroupStats();
            const maxAvg = Math.max(...groupStats.map(g => g.avgDaily));

            container.innerHTML = groupStats.map((group, idx) => {
                const rank = idx + 1;
                let rankClass = '';
                if (rank === 1) rankClass = 'gold';
                else if (rank === 2) rankClass = 'silver';
                else if (rank === 3) rankClass = 'bronze';

                // íŒ€ ìˆœìœ„ ê³„ì‚°
                const teamStats = (group.teams || []).map(team => {
                    let teamSteps = 0;
                    let teamMemberCount = 0;
                    (team.members || []).forEach(name => {
                        const data = getMemberData(name);
                        teamSteps += parseInt(data['ì›”ëˆ„ì ']) || 0;
                        teamMemberCount++;
                    });
                    const teamAvgDaily = teamMemberCount > 0 ? Math.floor(teamSteps / teamMemberCount / dayOfMonth) : 0;
                    return { ...team, totalSteps: teamSteps, avgDaily: teamAvgDaily, memberCount: teamMemberCount };
                }).sort((a, b) => b.avgDaily - a.avgDaily);

                return `
                    <div class="group-card" id="group-${group.id}">
                        <div class="group-header" onclick="toggleGroup('${group.id}')">
                            <div class="group-rank ${rankClass}">#${rank}</div>
                            <div class="group-info">
                                <div class="group-name">${group.name}</div>
                                <div class="group-meta">${teamStats.length}íŒ€ Â· ${group.memberCount}ëª…</div>
                            </div>
                            <div class="group-stats">
                                <div class="group-avg">${formatNumber(group.avgDaily)}</div>
                                <div class="group-avg-label">ë³´/ì¼</div>
                            </div>
                            <div class="group-expand">â–¼</div>
                        </div>
                        <div class="group-body">
                            ${teamStats.map((team, tIdx) => {
                                const memberStats = (team.members || []).map(name => {
                                    const data = getMemberData(name);
                                    const monthlyTotal = parseInt(data['ì›”ëˆ„ì ']) || 0;
                                    const dailyAvg = Math.floor(monthlyTotal / dayOfMonth);
                                    return { name, dailyAvg, total: monthlyTotal };
                                }).sort((a, b) => b.dailyAvg - a.dailyAvg);

                                return `
                                    <div class="team-section" id="team-${group.id}-${team.id}">
                                        <div class="team-header" onclick="toggleTeam('${group.id}-${team.id}')">
                                            <span class="team-rank">${tIdx + 1}ìœ„</span>
                                            <span class="team-name">${team.name}</span>
                                            <span class="team-avg">${formatNumber(team.avgDaily)} ë³´/ì¼</span>
                                        </div>
                                        <div class="team-members">
                                            ${memberStats.map((m, mIdx) => `
                                                <div class="member-row" onclick="showMemberDetail('${m.name}')">
                                                    <span class="member-rank-num">${mIdx + 1}</span>
                                                    <span class="member-name">${m.name}</span>
                                                    <span class="member-avg">${formatNumber(m.dailyAvg)}</span>
                                                    <span class="member-total">(${formatNumber(m.total)})</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ê·¸ë£¹ í† ê¸€
        function toggleGroup(groupId) {
            const el = document.getElementById(`group-${groupId}`);
            el.classList.toggle('expanded');
        }

        // íŒ€ í† ê¸€
        function toggleTeam(teamId) {
            event.stopPropagation();
            const el = document.getElementById(`team-${teamId}`);
            el.classList.toggle('expanded');
        }

        // ì „ì²´ ë­í‚¹ ë Œë”ë§ (ë“±ë¡ëœ ë©¤ë²„ë§Œ)
        function renderAllRanking(filter = '') {
            const tbody = document.getElementById('allRankingBody');
            const today = new Date();
            const dayOfMonth = today.getDate();
            
            // ë“±ë¡ëœ ë©¤ë²„ë§Œ ëŒ€ìƒ
            const registeredData = getRegisteredMemberData();
            
            // ë©¤ë²„ë³„ ì†Œì† ì •ë³´ ë§¤í•‘
            const memberTeamMap = {};
            config.groups.forEach(g => {
                (g.teams || []).forEach(t => {
                    (t.members || []).forEach(m => {
                        memberTeamMap[m] = `${g.name} > ${t.name}`;
                    });
                });
            });

            // ì¼í‰ê·  ê¸°ì¤€ ì •ë ¬
            let sortedData = registeredData.map(d => {
                const monthlyTotal = parseInt(d['ì›”ëˆ„ì ']) || 0;
                const dailyAvg = Math.floor(monthlyTotal / dayOfMonth);
                return { ...d, dailyAvg };
            }).sort((a, b) => b.dailyAvg - a.dailyAvg);

            const maxAvg = sortedData.length > 0 ? sortedData[0].dailyAvg : 1;

            const filtered = filter 
                ? sortedData.filter(d => d['ì´ë¦„'].toLowerCase().includes(filter.toLowerCase()))
                : sortedData;

            tbody.innerHTML = filtered.map((row, idx) => {
                const rank = idx + 1;
                let rankClass = 'rank-default';
                if (rank === 1) rankClass = 'rank-1';
                else if (rank === 2) rankClass = 'rank-2';
                else if (rank === 3) rankClass = 'rank-3';

                const team = memberTeamMap[row['ì´ë¦„']] || '-';
                const barWidth = (row.dailyAvg / maxAvg * 100).toFixed(1);

                return `
                    <tr onclick="showMemberDetail('${row['ì´ë¦„']}')">
                        <td class="rank-cell"><span class="rank-badge ${rankClass}">${rank}</span></td>
                        <td><strong>${row['ì´ë¦„']}</strong></td>
                        <td style="color:#64748b;font-size:0.8rem;">${team}</td>
                        <td class="steps-cell">
                            <div class="steps-bar-container">
                                <div class="steps-bar-bg">
                                    <div class="steps-bar" style="width:${barWidth}%"></div>
                                </div>
                            </div>
                        </td>
                        <td style="text-align:right;">
                            <span class="steps-value">${formatNumber(row.dailyAvg)}</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterAllRanking() {
            const query = document.getElementById('searchInput').value;
            renderAllRanking(query);
        }

        // ì°¨íŠ¸ ë Œë”ë§ (ë“±ë¡ëœ ë©¤ë²„ë§Œ)
        function renderCharts() {
            const groupStats = getGroupStats();
            
            // ê·¸ë£¹ì´ ì—†ìœ¼ë©´ ì°¨íŠ¸ ì•ˆ ê·¸ë¦¼
            if (groupStats.length === 0) {
                document.getElementById('groupChart').parentElement.innerHTML = '<div style="text-align:center;color:#94a3b8;padding:40px;">ê·¸ë£¹ ë°ì´í„° ì—†ìŒ</div>';
                document.getElementById('distributionChart').parentElement.innerHTML = '<div style="text-align:center;color:#94a3b8;padding:40px;">ë°ì´í„° ì—†ìŒ</div>';
                return;
            }

            // ê·¸ë£¹ ë¹„êµ ì°¨íŠ¸
            const groupCtx = document.getElementById('groupChart');
            if (groupChartInstance) groupChartInstance.destroy();
            
            groupChartInstance = new Chart(groupCtx, {
                type: 'bar',
                data: {
                    labels: groupStats.map(g => g.name),
                    datasets: [{
                        label: 'ì¼í‰ê·  (ë³´/ì¼)',
                        data: groupStats.map(g => g.avgDaily),
                        backgroundColor: groupStats.map((g, i) => {
                            if (i === 0) return '#f59e0b';
                            if (i === 1) return '#94a3b8';
                            if (i === 2) return '#c2410c';
                            return '#3b82f6';
                        }),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });

            // ë¶„í¬ ì°¨íŠ¸ (ë“±ë¡ëœ ë©¤ë²„ë§Œ)
            const today = new Date();
            const dayOfMonth = today.getDate();
            
            const registeredData = getRegisteredMemberData();
            const avgData = registeredData.map(d => {
                const total = parseInt(d['ì›”ëˆ„ì ']) || 0;
                return Math.floor(total / dayOfMonth);
            });

            // êµ¬ê°„ë³„ ë¶„í¬
            const ranges = [
                { label: '5ì²œ ë¯¸ë§Œ', min: 0, max: 5000 },
                { label: '5ì²œ~1ë§Œ', min: 5000, max: 10000 },
                { label: '1ë§Œ~1.5ë§Œ', min: 10000, max: 15000 },
                { label: '1.5ë§Œ~2ë§Œ', min: 15000, max: 20000 },
                { label: '2ë§Œ ì´ìƒ', min: 20000, max: Infinity }
            ];

            const distData = ranges.map(r => 
                avgData.filter(v => v >= r.min && v < r.max).length
            );

            const distCtx = document.getElementById('distributionChart');
            if (distChartInstance) distChartInstance.destroy();

            distChartInstance = new Chart(distCtx, {
                type: 'doughnut',
                data: {
                    labels: ranges.map(r => r.label),
                    datasets: [{
                        data: distData,
                        backgroundColor: ['#ef4444', '#f97316', '#eab308', '#22c55e', '#3b82f6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 1.5,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { boxWidth: 12, padding: 12 }
                        }
                    }
                }
            });
        }

        // ê°œì¸ ìƒì„¸ ëª¨ë‹¬
        async function showMemberDetail(name) {
            const modal = document.getElementById('memberModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalTitle.textContent = name;
            modalBody.innerHTML = '<div class="loading"><div class="spinner"></div>ë¡œë”© ì¤‘...</div>';
            modal.classList.add('active');

            const today = new Date();
            const dayOfMonth = today.getDate();
            const currentData = getMemberData(name);
            const monthlyTotal = parseInt(currentData['ì›”ëˆ„ì ']) || 0;
            const dailyAvg = Math.floor(monthlyTotal / dayOfMonth);
            
            // ê°œì¸ íˆìŠ¤í† ë¦¬ ë¡œë“œ
            const monthStr = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
            const fileName = encodeURIComponent(`${name}_${monthStr}_Data.csv`);
            const url = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${BRANCH}/data/members/${fileName}?t=${Date.now()}`;

            let history = [];
            try {
                const res = await fetch(url);
                if (res.ok) {
                    const csv = await res.text();
                    history = parseCSV(csv);
                }
            } catch (e) {}

            // í†µê³„ ê³„ì‚°
            const dailySteps = history.map(h => parseInt(h['ì˜¤ëŠ˜ê±¸ìŒìˆ˜']) || 0).filter(v => v > 0);
            const totalDays = dailySteps.length;
            const avgSteps = totalDays > 0 ? Math.floor(dailySteps.reduce((a,b) => a+b, 0) / totalDays) : 0;
            const maxSteps = dailySteps.length > 0 ? Math.max(...dailySteps) : 0;
            const minSteps = dailySteps.length > 0 ? Math.min(...dailySteps) : 0;
            const maxDay = history.find(h => parseInt(h['ì˜¤ëŠ˜ê±¸ìŒìˆ˜']) === maxSteps)?.['ë‚ ì§œ'] || '-';
            const minDay = history.find(h => parseInt(h['ì˜¤ëŠ˜ê±¸ìŒìˆ˜']) === minSteps)?.['ë‚ ì§œ'] || '-';

            modalBody.innerHTML = `
                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="stat-box-value">${formatNumber(dailyAvg)}</div>
                        <div class="stat-box-label">ì¼í‰ê·  (ë³´/ì¼)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-value">${formatNumber(monthlyTotal)}</div>
                        <div class="stat-box-label">ì›” ëˆ„ì </div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-value">${formatNumber(maxSteps)}</div>
                        <div class="stat-box-label">ìµœëŒ€</div>
                        <div class="stat-box-sub">${maxDay}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-value">${formatNumber(minSteps)}</div>
                        <div class="stat-box-label">ìµœì†Œ</div>
                        <div class="stat-box-sub">${minDay}</div>
                    </div>
                </div>

                <div style="height:200px;">
                    <canvas id="memberChart"></canvas>
                </div>

                <div class="calendar">
                    <div class="calendar-title">ğŸ“… ${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›”</div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            `;

            // ê°œì¸ ì°¨íŠ¸
            renderMemberChart(history);
            renderCalendar(today.getFullYear(), today.getMonth(), history);
        }

        function renderMemberChart(history) {
            const ctx = document.getElementById('memberChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(h => h['ë‚ ì§œ']),
                    datasets: [{
                        label: 'ì¼ë³„ ê±¸ìŒìˆ˜',
                        data: history.map(h => parseInt(h['ì˜¤ëŠ˜ê±¸ìŒìˆ˜']) || 0),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function renderCalendar(year, month, history) {
            const grid = document.getElementById('calendarGrid');
            const today = new Date();
            
            const historyMap = {};
            history.forEach(h => {
                historyMap[h['ë‚ ì§œ']] = parseInt(h['ì˜¤ëŠ˜ê±¸ìŒìˆ˜']) || 0;
            });

            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            let html = days.map(d => `<div class="calendar-header">${d}</div>`).join('');

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day empty"></div>';
            }

            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${String(month + 1).padStart(2, '0')}/${String(date).padStart(2, '0')}`;
                const steps = historyMap[dateStr];
                const isToday = year === today.getFullYear() && month === today.getMonth() && date === today.getDate();
                const hasData = steps !== undefined;

                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''} ${hasData ? 'has-data' : ''}">
                        <div class="day-num">${date}</div>
                        ${hasData ? `<div class="day-steps">${(steps/1000).toFixed(0)}k</div>` : ''}
                    </div>
                `;
            }

            grid.innerHTML = html;
        }

        function closeModal() {
            document.getElementById('memberModal').classList.remove('active');
        }

        function formatNumber(n) {
            return n.toLocaleString('ko-KR');
        }

        // í†µê³„ íƒ­ ì „í™˜
        function switchStatTab(tab) {
            document.querySelectorAll('[data-stat]').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-stat="${tab}"]`).classList.add('active');
            
            document.getElementById('statAll').style.display = tab === 'all' ? 'block' : 'none';
            document.getElementById('statGroup').style.display = tab === 'group' ? 'block' : 'none';
            document.getElementById('statTeam').style.display = tab === 'team' ? 'block' : 'none';

            if (tab === 'group') {
                populateGroupSelect();
            } else if (tab === 'team') {
                populateTeamGroupSelect();
            }
        }

        // ê·¸ë£¹ ì„ íƒ ëª©ë¡ ì±„ìš°ê¸°
        function populateGroupSelect() {
            const select = document.getElementById('groupSelect');
            select.innerHTML = '<option value="">ê·¸ë£¹ ì„ íƒ</option>' + 
                config.groups.map(g => `<option value="${g.id}">${g.name}</option>`).join('');
        }

        // íŒ€ íƒ­ì˜ ê·¸ë£¹ ì„ íƒ ëª©ë¡ ì±„ìš°ê¸°
        function populateTeamGroupSelect() {
            const select = document.getElementById('teamGroupSelect');
            select.innerHTML = '<option value="">ê·¸ë£¹ ì„ íƒ</option>' + 
                config.groups.map(g => `<option value="${g.id}">${g.name}</option>`).join('');
            document.getElementById('teamSelect').innerHTML = '<option value="">íŒ€ ì„ íƒ</option>';
        }

        // íŒ€ ì„ íƒ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateTeamSelect() {
            const groupId = document.getElementById('teamGroupSelect').value;
            const teamSelect = document.getElementById('teamSelect');
            
            if (!groupId) {
                teamSelect.innerHTML = '<option value="">íŒ€ ì„ íƒ</option>';
                return;
            }

            const group = config.groups.find(g => g.id === groupId);
            teamSelect.innerHTML = '<option value="">íŒ€ ì„ íƒ</option>' + 
                (group?.teams || []).map(t => `<option value="${t.id}">${t.name}</option>`).join('');
        }

        // ê·¸ë£¹ í†µê³„ ë Œë”ë§
        let groupStatChart = null;
        function renderGroupStat() {
            const groupId = document.getElementById('groupSelect').value;
            const container = document.getElementById('groupStatContent');
            
            if (!groupId) {
                container.innerHTML = '<div style="text-align:center;color:#94a3b8;padding:40px;">ê·¸ë£¹ì„ ì„ íƒí•˜ì„¸ìš”</div>';
                return;
            }

            const group = config.groups.find(g => g.id === groupId);
            const today = new Date();
            const dayOfMonth = today.getDate();

            // íŒ€ë³„ í†µê³„
            const teamStats = (group.teams || []).map(team => {
                let teamSteps = 0;
                let memberCount = 0;
                (team.members || []).forEach(name => {
                    const data = getMemberData(name);
                    teamSteps += parseInt(data['ì›”ëˆ„ì ']) || 0;
                    memberCount++;
                });
                const avgDaily = memberCount > 0 ? Math.floor(teamSteps / memberCount / dayOfMonth) : 0;
                return { name: team.name, avgDaily, memberCount, totalSteps: teamSteps };
            }).sort((a, b) => b.avgDaily - a.avgDaily);

            const groupTotal = teamStats.reduce((sum, t) => sum + t.totalSteps, 0);
            const groupMembers = teamStats.reduce((sum, t) => sum + t.memberCount, 0);
            const groupAvg = groupMembers > 0 ? Math.floor(groupTotal / groupMembers / dayOfMonth) : 0;

            container.innerHTML = `
                <div class="summary-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:20px;">
                    <div class="summary-card">
                        <div class="summary-label">ê·¸ë£¹ ì¼í‰ê· </div>
                        <div class="summary-value">${formatNumber(groupAvg)}</div>
                        <div class="summary-sub">ë³´/ì¼</div>
                    </div>
                    <div class="summary-card gold">
                        <div class="summary-label">ì´ ì¸ì›</div>
                        <div class="summary-value">${groupMembers}</div>
                        <div class="summary-sub">ëª…</div>
                    </div>
                    <div class="summary-card green">
                        <div class="summary-label">íŒ€ ìˆ˜</div>
                        <div class="summary-value">${teamStats.length}</div>
                        <div class="summary-sub">íŒ€</div>
                    </div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">ğŸ“Š ${group.name} íŒ€ë³„ ì¼í‰ê· </div>
                    <canvas id="groupStatChart"></canvas>
                </div>
            `;

            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            if (groupStatChart) groupStatChart.destroy();
            groupStatChart = new Chart(document.getElementById('groupStatChart'), {
                type: 'bar',
                data: {
                    labels: teamStats.map(t => t.name),
                    datasets: [{
                        label: 'ì¼í‰ê·  (ë³´/ì¼)',
                        data: teamStats.map(t => t.avgDaily),
                        backgroundColor: '#3b82f6',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // íŒ€ í†µê³„ ë Œë”ë§
        let teamStatChart = null;
        function renderTeamStat() {
            const groupId = document.getElementById('teamGroupSelect').value;
            const teamId = document.getElementById('teamSelect').value;
            const container = document.getElementById('teamStatContent');
            
            if (!groupId || !teamId) {
                container.innerHTML = '<div style="text-align:center;color:#94a3b8;padding:40px;">íŒ€ì„ ì„ íƒí•˜ì„¸ìš”</div>';
                return;
            }

            const group = config.groups.find(g => g.id === groupId);
            const team = group?.teams?.find(t => t.id === teamId);
            const today = new Date();
            const dayOfMonth = today.getDate();

            // ë©¤ë²„ë³„ í†µê³„
            const memberStats = (team.members || []).map(name => {
                const data = getMemberData(name);
                const monthlyTotal = parseInt(data['ì›”ëˆ„ì ']) || 0;
                const avgDaily = Math.floor(monthlyTotal / dayOfMonth);
                return { name, avgDaily, total: monthlyTotal };
            }).sort((a, b) => b.avgDaily - a.avgDaily);

            const teamTotal = memberStats.reduce((sum, m) => sum + m.total, 0);
            const teamAvg = memberStats.length > 0 ? Math.floor(teamTotal / memberStats.length / dayOfMonth) : 0;
            const maxMember = memberStats[0] || { name: '-', avgDaily: 0 };
            const minMember = memberStats[memberStats.length - 1] || { name: '-', avgDaily: 0 };

            container.innerHTML = `
                <div class="summary-grid" style="margin-bottom:20px;">
                    <div class="summary-card">
                        <div class="summary-label">íŒ€ ì¼í‰ê· </div>
                        <div class="summary-value">${formatNumber(teamAvg)}</div>
                        <div class="summary-sub">ë³´/ì¼</div>
                    </div>
                    <div class="summary-card gold">
                        <div class="summary-label">íŒ€ ì¸ì›</div>
                        <div class="summary-value">${memberStats.length}</div>
                        <div class="summary-sub">ëª…</div>
                    </div>
                    <div class="summary-card green">
                        <div class="summary-label">1ìœ„</div>
                        <div class="summary-value">${maxMember.name}</div>
                        <div class="summary-sub">${formatNumber(maxMember.avgDaily)} ë³´/ì¼</div>
                    </div>
                    <div class="summary-card purple">
                        <div class="summary-label">ìµœì €</div>
                        <div class="summary-value">${minMember.name}</div>
                        <div class="summary-sub">${formatNumber(minMember.avgDaily)} ë³´/ì¼</div>
                    </div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">ğŸ“Š ${team.name} ë©¤ë²„ë³„ ì¼í‰ê· </div>
                    <canvas id="teamStatChart"></canvas>
                </div>
            `;

            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            if (teamStatChart) teamStatChart.destroy();
            teamStatChart = new Chart(document.getElementById('teamStatChart'), {
                type: 'bar',
                data: {
                    labels: memberStats.map(m => m.name),
                    datasets: [{
                        label: 'ì¼í‰ê·  (ë³´/ì¼)',
                        data: memberStats.map(m => m.avgDaily),
                        backgroundColor: memberStats.map((m, i) => {
                            if (i === 0) return '#f59e0b';
                            if (i === memberStats.length - 1) return '#ef4444';
                            return '#3b82f6';
                        }),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }
    </script>
</body>
</html>
